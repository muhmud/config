#!/bin/bash

echo "$1 CC:98:8B:F5:0A:AE" | bluetoothctl

if [[ "$1" == "connect" ]]; then
  sleep 1;

  NEW_SINK=`pacmd list-sinks | grep -zoP 'index[:] ([0-9]+).*\n.*bluez.*' | head -n 1 | awk -F ': ' '{ print $2; }'`
  NEW_SOURCE=`pacmd list-sources | grep -zoP 'index[:] ([0-9]+).*\n.*bluez.*' | head -n 1 | awk -F ': ' '{ print $2; }'`

  /usr/bin/pacmd set-default-sink $NEW_SINK
  /usr/bin/pacmd set-default-source $NEW_SOURCE

  /usr/bin/pacmd list-sink-inputs | grep index | awk -F ': ' '{ print $2; }' | xargs -I % /usr/bin/pacmd move-sink-input % $NEW_SINK
fi;
